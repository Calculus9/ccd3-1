!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ccd3=t.ccd3||{})}(this,(function(t){"use strict";function e(t,e,i){this._data=t||this._data,this._option=e||this._option,this._theme=i||this._theme,this.render()}class i{constructor(t){this._Class=t}init(t,i,a){const r=new(0,this._Class)(t,i,a);return[r,(t,i,a)=>e.call(r,t,i,a)]}}const a=new class{constructor(){this._strategies=new Map}registerStrategy(t,e){try{if(this._strategies.has(t))throw new Error(`The [${chartkey}] has been registered.Please change the name and re register.`);return this._strategies.set(t,new i(e)),this}catch(t){console.error(t)}}useStrategy(t,e,i){try{const{name:a}=e;if("string"!=typeof a)throw new Error("The [name] attribute must be included in option.[name] is used to indicate a chart.");if(!this._strategies.has(a))throw new Error(`The [${a}] chart doesn't exist in the chart factory.`);return this._strategies.get(a).init(t,e,i)}catch(t){console.error(t)}}};function r(){this._axisBottomScale=d3.scaleBand();const{axisBottom:{key:t,scale:{reverse:e=!1,paddingInner:i=.5,paddingOuter:a=.5}}}=this._option;this._axisBottomScale.domain(this._data.map((e=>e[t]))).range(e?[this._innerWidth,0]:[0,this._innerWidth]).paddingInner(i).paddingOuter(a),this._bottomScale=t=>+this._axisBottomScale(t),this._bandwidth=()=>this._axisBottomScale.bandwidth()}function o(){this._axisBottomScale=d3.scaleLinear();const{axisBottom:{key:t,scale:{extent:e=!1,reverse:i=!1,nice:a=!0}}}=this._option;this._axisBottomScale.domain(e?d3.extent(this._data,(e=>e[t])):[0,d3.max(this._data,(e=>e[t]))]).range(i?[this._innerWidth,0]:[0,this._innerWidth]),a&&this._axisBottomScale.nice(),this._bottomScale=t=>+this._axisBottomScale(t)}function s(){if(!this._option.axisBottom||!this._option.axisBottom.scale||!this._option.axisBottom.scale.name)throw new TypeError("[axisBottom] Error!");n.call(this),l.call(this)}function n(){const{axisBottom:{scale:{name:t}}}=this._option;switch(t){case"scaleBand":r.call(this);break;case"scaleLinear":o.call(this);break;default:throw new Error("Unrecognized scale name")}}function l(){(()=>{this._axisBottomGroup||(this._zoomGroup?this._axisBottomGroup=this._zoomGroup.insert("g",`#${this._domId}MainGroup`):this._axisBottomGroup=this._svg.insert("g",`#${this._domId}MainGroup`),this._axisBottomGroup.attr("id",`${this._domId}AxisBottomGroup`).attr("transform",`translate(${this._margin.left},${this._innerHeight+this._margin.top})`))})(),(()=>{const{axisBottom:{grid:t=!1,transition:{duration:e,ease:i}}}=this._option,{axisBottom:{tickColor:a="#ccc",textColor:r="#999",lineColor:o="#ccc"}}=this._theme;this._axisBottomGroup.transition().duration(e).ease(i).call((e=>{const i=d3.axisBottom(this._axisBottomScale);return t&&i.tickSizeInner(-this._innerHeight).tickSizeOuter(-this._innerHeight),i(e)})).call((t=>{t.selectAll("text").attr("fill",r),t.selectAll("line").attr("stroke",a),t.selectAll("path").attr("stroke",o)}))})()}function h(){this._axisLeftScale=d3.scaleBand();const{axisLeft:{key:t,scale:{reverse:e=!1,paddingInner:i=.5,paddingOuter:a=.5}}}=this._option;this._axisLeftScale.domain(this._data.map((e=>e[t]))).range(e?[0,this._innerHeight]:[this._innerHeight,0]).paddingInner(i).paddingOuter(a),this._leftScale=t=>+this._axisLeftScale(t),this._bandwidth=()=>this._axisLeftScale.bandwidth()}function c(){this._axisLeftScale=d3.scaleLinear();const{axisLeft:{key:t,scale:{extent:e=!1,reverse:i=!1,nice:a=!0}}}=this._option;this._axisLeftScale.domain(e?d3.extent(this._data,(e=>e[t])):[0,d3.max(this._data,(e=>e[t]))]).range(i?[0,this._innerHeight]:[this._innerHeight,0]),a&&this._axisLeftScale.nice(),this._leftScale=t=>+this._axisLeftScale(t)}function d(){if(!this._option.axisLeft||!this._option.axisLeft.scale||!this._option.axisLeft.scale.name)throw new TypeError("[axisLeft] Error!");_.call(this),p.call(this)}function _(){const{axisLeft:{scale:{name:t}}}=this._option;switch(t){case"scaleBand":h.call(this);break;case"scaleLinear":c.call(this);break;default:throw new Error("Unrecognized scale name")}}function p(){(()=>{this._axisLeftGroup||(this._zoomGroup?this._axisLeftGroup=this._zoomGroup.insert("g",`#${this._domId}MainGroup`):this._axisLeftGroup=this._svg.insert("g",`#${this._domId}MainGroup`),this._axisLeftGroup.attr("id",`${this._domId}axisLeftGroup`).attr("class","axis-bottom-group").attr("transform",`translate(${this._margin.left},${this._margin.top})`))})(),(()=>{const{axisLeft:{grid:t=!1,transition:{duration:e,ease:i}}}=this._option,{axisBottom:{tickColor:a="#ccc",textColor:r="#999",lineColor:o="#ccc"}}=this._theme;this._axisLeftGroup.transition().duration(e).ease(i).call((e=>{const i=d3.axisLeft(this._axisLeftScale);return t&&i.tickSizeInner(-this._innerWidth).tickSizeOuter(-this._innerWidth),i(e)})).call((t=>{t.selectAll("text").attr("fill",r),t.selectAll("line").attr("stroke",a),t.selectAll(".tick:last-child line").attr("stroke",o),t.selectAll(".tick:first-child line").attr("stroke",o),t.selectAll("path").attr("stroke",o)}))})()}function u(t,e,i,a){if(void 0!==this[t])return null;switch(i){case"main":this[t]=m.call(this,e,a);break;case"zoom":this[t]=f.call(this,e,a);break;case"svg":this[t]=y.call(this,e,a);break;default:this[t]=m.call(this,e,a)}return null}function m(t,e){return this._mainGroup.append("g").classed(t,!0).attr("transform",e)}function f(t,e){return this._zoomGroup.append("g").classed(t,!0).attr("transform",e)}function y(t,e){return this._svg.append("g").classed(t,!0).attr("transform",e)}function g(){const{name:t,layout:{margin:e,zoom:i}}=this._option;this._name=t,this._margin={top:e.top,right:e.right,bottom:e.bottom,left:e.left},this._zoom=i}function x(){const{layout:{backgroundColor:t="red",color:e="#212121"}}=this._theme;this._container=d3.select(`#${this._domId}`).append("div").attr("id",`${this._domId}Container`).style("background-color",t).style("color",e).style("position","relative").style("width","100%").style("height","100%")}function S(){this._width=this._container.node().clientWidth,this._height=this._container.node().clientHeight,this._innerHeight=this._height-this._margin.top-this._margin.bottom,this._innerWidth=this._width-this._margin.left-this._margin.right,this._viewBox=`0 0 ${this._width} ${this._height}`}function k(){this._svg=this._container.append("svg").attr("id",`${this._domId}Svg`).attr("viewBox",this._viewBox)}function b(){this._svg.call(d3.zoom().on("zoom",(t=>{this._zoomGroup.attr("transform",`translate(${t.transform.x},${t.transform.y}) scale(${t.transform.k})`)})))}function G(){const{layout:{zoom:t=!1}}=this._option;return t?(this._zoomGroup=this._svg.append("g").attr("id",`${this._domId}ZoomGroup`).attr("class","zoom-group"),b.call(this),this._zoomGroup.append("g")):this._svg.append("g")}function v(){this._mainGroup=G.call(this),this._mainGroup.attr("id",`${this._domId}MainGroup`).attr("transform",`translate(${this._margin.left},${this._margin.top})`)}function $(){g.call(this),x.call(this),S.call(this),k.call(this),v.call(this)}function z(){const{title:{text:t}}=this._option,{title:{transition:{duration:e,ease:i}}}=this._option,{title:{textStyle:{x:a="0",y:r="0",color:o="#516b91",fontSize:s="1.5em",fontWeight:n="700"}}}=this._theme;this._titleGroup.selectAll(".title").data([t]).join((t=>t.append("text").attr("class","title").attr("dy","1em").attr("x",a).attr("y",r).style("fill",o).style("font-size",s).style("font-weight",n)),(t=>t.transition().duration(e).ease(i).attr("class","title").attr("dy","1em").attr("x",a).attr("y",r).style("fill",o).style("font-size",s).style("font-weight",n).selection()),(t=>t.remove())).html((t=>t))}function K(){const{title:{subText:t}}=this._option,{title:{subTextStyle:{x:e="0",y:i="0",color:a="#516b91",fontSize:r="1.5em",fontWeight:o="700"}}}=this._theme;this._titleGroup.selectAll(".sub-title").data([t]).join((t=>t.append("text").attr("class","sub-title").attr("dy","3em").attr("x",e).attr("y",i).style("fill",a).style("font-size",r).style("font-weight",o)),(t=>t.transition().attr("class","sub-title").attr("dy","3em").attr("x",e).attr("y",i).style("fill",a).style("font-size",r).style("font-weight",o).selection()),(t=>t.remove())).html((t=>t))}function w(){}function E(){this._titleGroup||u.call(this,"_titleGroup","title-group","svg","translate(0,0)"),z.call(this),K.call(this),w.call(this)}function B(){const{tooltip:{pointerEvents:t="none",textColor:e="#212121",backgroundColor:i="#ffffffcc",boxShadow:a="0 3px 14px rgba(0,0,0,0.4)",border:r=" 1px solid #eee",borderRadius:o="5px",padding:s="0.75rem 1rem",whiteSpace:n="no-warp",zIndex:l="3080",position:h="absolute"}}=this._theme;this._tooltip||(this._tooltip=this._container.append("div").style("pointer-events",t).style("white-space",n).style("border-radius",o).style("color",e).style("background-color",i).style("border",r).style("box-shadow",a).style("padding",s).style("z-index",l).style("position",h).style("top",0).style("display","none"))}function L(t,e){const{tooltip:{transition:{duration:i,ease:a}}}=this._option;this[t].style("cursor","pointer").on("mouseover",(t=>{this._tooltip.transition().style("display","block"),d3.select(t.target).attr("opacity","0.75")})).on("mousemove",((t,r)=>{let o=`${t.offsetX}px`,s=`${t.offsetY}px`;this._tooltip.html(e(t,r)).transition().duration(i).ease(a).style("left",o).style("top",s)})).on("mouseout",(t=>{this._tooltip.transition().style("display","none"),d3.select(t.target).attr("opacity","1")}))}function T(t,e){B.call(this),L.call(this,t,e)}const j={name:"lightBlue",primary1:"#93b7e3",primary2:"#59c4e6",primary3:"#edafda",primary4:"#516b91",primary5:"#a5e7f0",primary6:"#cbb0e3",colorSets:["#93b7e3"," #59c4e6","#edafda"," #516b91","#a5e7f0"," #cbb0e3"," #3fb1e3"," #6be6c1"," #626c91","#a0a7e6","#c4ebad","#96dee8"],layout:{backgroundColor:"#fff",textColor:"#212121",labelColor:"#eee"},title:{textStyle:{x:"0",y:"0",color:"#516b91",fontSize:"1.5em",fontWeight:"700"},subTextStyle:{x:"0",y:"0",color:"#93b7e3",fontSize:"1em",fontWeight:"400"}},axisBottom:{tickColor:"#eee",lineColor:"#ccc",textColor:"#999"},axisLeft:{lineColor:"#ccc",textColor:"#999"},tooltip:{pointerEvents:"none",textColor:"#212121",backgroundColor:"#ffffffcc",boxShadow:"0 3px 14px rgba(0,0,0,0.4)",border:" 1px solid #eee",borderRadius:"5px",padding:"0.75rem 1rem",whiteSpace:"no-warp",zIndex:"3080",position:"absolute"}};class C{constructor(t,e,i){this._domId=t,this._option=e,this._theme=i||j,$.call(this,t,e)}render(){s.call(this),d.call(this),E.call(this),u.call(this,"_rectGroup","rect-group","main"),this.renderColorScale(),this.renderRect()}renderColorScale(){const{algorithmBar:{state:t}}=this._option;this._colorScale=d3.scaleOrdinal().domain(Object.keys(t)).range(Object.values(t))}renderRect(){const{algorithmBar:{uniqueKey:t,stateKey:e,animation:{duration:i,ease:a},on:{click:r}},axisBottom:{key:o},axisLeft:{key:s},tooltip:{format:n}}=this._option;this._rectElements=this._rectGroup.selectAll("rect").data(this._data,t?e=>e[t]:t).join((t=>t.append("rect").attr("width",this._bandwidth()).attr("y",this._innerHeight).attr("x",(t=>this._bottomScale(t[o])))),(t=>t),(t=>t.remove())).transition().duration(i).ease(a).attr("height",(t=>this._innerHeight-this._leftScale(t[s]))).attr("y",(t=>this._leftScale(t[s]))).attr("x",(t=>this._bottomScale(t[o]))).attr("fill",(t=>this._colorScale(t[e]))).selection().on("click",((t,e)=>r(t,e,this._data))),T.call(this,"_rectElements",n)}}class A{constructor(t,e,i){this._domId=t,this._option=e,this._theme=i||j,$.call(this,t,e)}render(){E.call(this),u.call(this,"_pathGroup","path-group","main"),u.call(this,"_nodeGroup","node-group","main"),u.call(this,"_textGroup","text-group","main"),this.renderColorScale(),this.renderData(),this.renderScale(),this.renderPath(),this.renderNode(),this.renderText()}renderColorScale(){const{algorithmTree:{state:t}}=this._option;this._colorScale=d3.scaleOrdinal().domain(Object.keys(t)).range(Object.values(t))}renderData(){const{algorithmTree:{valueKey:t,childrenKey:e}}=this._option,i=d3.hierarchy(this._data,(t=>t[e]));this._rootData=d3.tree().size([this._innerWidth,this._innerHeight])(i)}renderScale(){const{algorithmTree:{valueKey:t,node:{radiusExtent:e}}}=this._option;let i=-1/0,a=1/0;const r=e=>{e&&(i=Math.max(i,e[t]),a=Math.min(a,e[t]),e.children&&e.children.forEach((t=>r(t))))};r(this._data),this._valueScale=d3.scaleLinear().domain([a,i]).range(e)}renderPath(){const{algorithmTree:{uniqueKey:t,stateKey:e,animation:{duration:i,ease:a}}}=this._option;this._pathGroupElements=this._pathGroup.selectAll("path").data(this._rootData.links(),(e=>e.target.data[t])).join((t=>t.append("path").attr("d",(t=>d3.linkVertical().x((t=>t.x)).y((t=>t.y))({source:t.source,target:t.source}))).selection()),(t=>t),(t=>t.remove())).transition().duration(i).ease(a).attr("stroke",(t=>this._colorScale(t.target.data[e]))).attr("fill","none").attr("d",d3.linkVertical().x((t=>t.x)).y((t=>t.y)))}renderNode(){const{algorithmTree:{uniqueKey:t,nodeKey:e,childrenKey:i,valueKey:a,stateKey:r,animation:{duration:o,ease:s}},tooltip:{format:n}}=this._option;this._nodeGroupElements=this._nodeGroup.selectAll("circle").data(this._rootData.descendants(),(e=>e.data[t])).join((t=>t.append("circle").attr("transform",(t=>`translate(${t.x}, ${t.y})`))),(t=>t),(t=>t.remove())).transition().duration(o).ease(s).attr("fill",(t=>this._colorScale(t.data[r]))).attr("r",(t=>this._valueScale(t.data[a]))).attr("transform",(t=>`translate(${t.x}, ${t.y})`)).selection().style("cursor","pointer").classed("subtree-hidden",(t=>!!t.data[`_${i}`])).classed("leaf-node",(t=>!t.data[i])),T.call(this,"_nodeGroupElements",n||((t,i)=>`${i.ancestors().map((t=>t.data[e])).reverse().join("-><br/>")} : <strong>${d3.format(",d")(i.data[a])} </strong>`))}renderText(){const{algorithmTree:{nodeKey:t,valueKey:e,uniqueKey:i,animation:{duration:a,ease:r}},tooltip:{format:o}}=this._option;this._textGroupElements=this._textGroup.selectAll("text").data(this._rootData.descendants(),(t=>t.data[i])).join((t=>t.append("text").attr("transform",(t=>`translate(${t.x}, ${t.y}) rotate(90)`))),(t=>t),(t=>t.remove())).transition().duration(a).ease(r).attr("font-size",(t=>this._valueScale(t.data[e]))).attr("dy","0.31em").attr("dx","10").attr("transform",(t=>`translate(${t.x}, ${t.y}) rotate(90)`)).attr("dx",(t=>t.children?"-1em":"1em")).attr("text-anchor",(t=>t.children?"end":"start")).selection().html((e=>e.data[t])).style("cursor","pointer"),T.call(this,"_textGroupElements",o||((i,a)=>`${a.ancestors().map((e=>e.data[t])).reverse().join("-><br/>")} : <strong>${d3.format(",d")(a.data[e])} </strong>`))}}a.registerStrategy("algorithmBar",C).registerStrategy("algorithmTree",A);class I{constructor(t,e,i){this._domId=t,this._option=e,this._theme=i||j,$.call(this,t,e)}render(){s.call(this),d.call(this),E.call(this),u.call(this,"_rectGroup","rect-group","main"),this.renderRect()}renderRect(){const{horizontalBar:{uniqueKey:t,animation:{duration:e,ease:i},on:{click:a}},axisBottom:{key:r},axisLeft:{key:o},tooltip:{format:s}}=this._option;console.log(r);const{primary1:n}=this._theme;this._rectElements=this._rectGroup.selectAll("rect").data(this._data,t?e=>e[t]:t).join((t=>t.append("rect").attr("height",this._bandwidth()).attr("width",0).attr("y",(t=>this._leftScale(t[o])))),(t=>t),(t=>t.remove())).transition().duration(e).ease(i).attr("height",this._bandwidth()).attr("width",(t=>this._bottomScale(t[r]))).attr("y",(t=>this._leftScale(t[o]))).attr("fill",n).selection().on("click",((t,e)=>a(t,e,this._data))),T.call(this,"_rectElements",s)}}class D{constructor(t,e,i){this._domId=t,this._option=e,this._theme=i||j,$.call(this,t,e)}render(){s.call(this),d.call(this),E.call(this),u.call(this,"_rectGroup","rect-group","main"),this.renderRect()}renderRect(){const{verticalBar:{uniqueKey:t,animation:{duration:e,ease:i},on:{click:a}},axisBottom:{key:r},axisLeft:{key:o},tooltip:{format:s}}=this._option,{primary1:n}=this._theme;this._rectElements=this._rectGroup.selectAll("rect").data(this._data,t?e=>e[t]:t).join((t=>t.append("rect").attr("width",this._bandwidth()).attr("y",this._innerHeight).attr("x",(t=>this._bottomScale(t[r])))),(t=>t),(t=>t.remove())).transition().duration(e).ease(i).attr("height",(t=>this._innerHeight-this._leftScale(t[o]))).attr("y",(t=>this._leftScale(t[o]))).attr("x",(t=>this._bottomScale(t[r]))).attr("fill",n).selection().on("click",((t,e)=>a(t,e,this._data))),T.call(this,"_rectElements",s)}}a.registerStrategy("horizontalBar",I).registerStrategy("verticalBar",D);class H{constructor(t,e,i){this._domId=t,this._option=e,this._theme=i||j,$.call(this,t,e)}render(){E.call(this),u.call(this,"_pathGroup","path-group","main",`translate(${this._innerWidth/2},${this._innerHeight/2})`),u.call(this,"_legendGroup","legend-group","main",`translate(${this._innerWidth},0)`),this.renderData(),this.renderScale(),this.renderPath()}renderData(){const{pie:{categoryKey:t,valueKey:e,innerRadius:i}}=this._option;this._radius=Math.min(this._innerHeight,this._innerWidth)/2,this._pieData=d3.pie().sort((e=>e[t])).value((t=>t[e]))(this._data),this._arc=d3.arc().innerRadius(i).outerRadius(this._radius)}renderScale(){const{pie:{categoryKey:t}}=this._option,{colorSets:e}=this._theme;this._colorScale||(this._colorScale=d3.scaleOrdinal().domain(this._data.map((e=>e[t]))).range(e))}renderPath(){const{pie:{uniqueKey:t,categoryKey:e,on:{click:i},animation:{duration:a,ease:r}},tooltip:{format:o}}=this._option;this._pathGroupElement=this._pathGroup.selectAll("path").data(this._pieData,(e=>e.data[t])).join("path").transition().duration(a).ease(r).attr("fill",(t=>this._colorScale(t.data[e]))).attr("d",(t=>this._arc(t))).selection().on("click",((t,e)=>i(t,e,this._data))),T.call(this,"_pathGroupElement",o)}}a.registerStrategy("pie",H);class O{constructor(t,e,i){this._domId=t,this._option=e,this._theme=i||j,$.call(this,t,e)}render(){E.call(this),u.call(this,"_pathGroup","path-group","main"),u.call(this,"_nodeGroup","node-group","main"),u.call(this,"_textGroup","text-group","main"),this.renderData(),this.renderScale(),this.renderPath(),this.renderNode(),this.renderText()}renderData(){const{horizontalTree:{valueKey:t,childrenKey:e}}=this._option,i=d3.hierarchy(this._data,(t=>t[e]));this._rootData=d3.tree().size([this._innerHeight,this._innerWidth])(i)}renderScale(){const{horizontalTree:{valueKey:t,node:{radiusExtent:e}}}=this._option;let i=-1/0,a=1/0;const r=e=>{e&&(i=Math.max(i,e[t]),a=Math.min(a,e[t]),e.children&&e.children.forEach((t=>r(t))))};r(this._data),this._valueScale=d3.scaleLinear().domain([a,i]).range(e)}renderPath(){const{horizontalTree:{uniqueKey:t,animation:{duration:e,ease:i}}}=this._option,{primary1:a}=this._theme;this._pathGroupElements=this._pathGroup.selectAll("path").data(this._rootData.links(),(e=>e.target.data[t])).join((t=>t.append("path").attr("d",(t=>d3.linkHorizontal().x((t=>t.y)).y((t=>t.x))({source:t.source,target:t.source})))),(t=>t),(t=>t.remove())).transition().duration(e).ease(i).attr("stroke",a).attr("fill","none").attr("d",d3.linkHorizontal().x((t=>t.y)).y((t=>t.x)))}renderNode(){const{horizontalTree:{uniqueKey:t,nodeKey:e,childrenKey:i,valueKey:a,animation:{duration:r,ease:o}},tooltip:{format:s}}=this._option,{primary4:n}=this._theme;this._nodeGroupElements=this._nodeGroup.selectAll("circle").data(this._rootData.descendants(),(e=>e.data[t])).join((t=>t.append("circle").attr("transform",(t=>`translate(${t.y}, ${t.x})`))),(t=>t),(t=>t.remove())).transition().duration(r).ease(o).attr("fill",n).attr("r",(t=>this._valueScale(t.data[a]))).attr("transform",(t=>`translate(${t.y}, ${t.x})`)).selection().style("cursor","pointer").classed("subtree-hidden",(t=>!!t.data[`_${i}`])).classed("leaf-node",(t=>!t.data[i])),T.call(this,"_nodeGroupElements",s||((t,i)=>`${i.ancestors().map((t=>t.data[e])).reverse().join("-><br/>")} : <strong>${d3.format(",d")(i.data[a])} </strong>`))}renderText(){const{horizontalTree:{nodeKey:t,valueKey:e,uniqueKey:i,animation:{duration:a,ease:r}},tooltip:{format:o}}=this._option;this._textGroupElements=this._textGroup.selectAll("text").data(this._rootData.descendants(),(t=>t.data[i])).join((t=>t.append("text").attr("transform",(t=>`translate(${t.y}, ${t.x}) rotate(90)`))),(t=>t),(t=>t.remove())).transition().duration(a).ease(r).attr("transform",(t=>`translate(${t.y}, ${t.x})`)).attr("font-size",(t=>this._valueScale(t.data[e]))).attr("dy","0.31em").attr("dx",(t=>t.children?"-1em":"1em")).attr("text-anchor",(t=>t.children?"end":"start")).selection().html((e=>e.data[t])).style("cursor","pointer"),T.call(this,"_textGroupElements",o||((i,a)=>`${a.ancestors().map((e=>e.data[t])).reverse().join("-><br/>")} : <strong>${d3.format(",d")(a.data[e])} </strong>`))}}class W{constructor(t,e,i){this._domId=t,this._option=e,this._theme=i||j,$.call(this,t,e)}render(){E.call(this),u.call(this,"_pathGroup","path-group","main"),u.call(this,"_nodeGroup","node-group","main"),u.call(this,"_textGroup","text-group","main"),this.renderData(),this.renderScale(),this.renderPath(),this.renderNode(),this.renderText()}renderData(){const{verticalTree:{valueKey:t,childrenKey:e}}=this._option,i=d3.hierarchy(this._data,(t=>t[e]));this._rootData=d3.tree().size([this._innerWidth,this._innerHeight])(i)}renderScale(){const{verticalTree:{valueKey:t,node:{radiusExtent:e}}}=this._option;let i=-1/0,a=1/0;const r=e=>{e&&(i=Math.max(i,e[t]),a=Math.min(a,e[t]),e.children&&e.children.forEach((t=>r(t))))};r(this._data),this._valueScale=d3.scaleLinear().domain([a,i]).range(e)}renderPath(){const{verticalTree:{uniqueKey:t,animation:{duration:e,ease:i}}}=this._option,{primary1:a}=this._theme;this._pathGroupElements=this._pathGroup.selectAll("path").data(this._rootData.links(),(e=>e.target.data[t])).join((t=>t.append("path").attr("d",(t=>d3.linkVertical().x((t=>t.x)).y((t=>t.y))({source:t.source,target:t.source})))),(t=>t),(t=>t.remove())).transition().duration(e).ease(i).attr("stroke",a).attr("fill","none").attr("d",d3.linkVertical().x((t=>t.x)).y((t=>t.y))).selection()}renderNode(){const{verticalTree:{uniqueKey:t,nodeKey:e,childrenKey:i,valueKey:a,animation:{duration:r,ease:o}},tooltip:{format:s}}=this._option,{primary4:n}=this._theme;this._nodeGroupElements=this._nodeGroup.selectAll("circle").data(this._rootData.descendants(),(e=>e.data[t])).join((t=>t.append("circle").attr("transform",(t=>`translate(${t.x}, ${t.y})`))),(t=>t),(t=>t.remove())).transition().duration(r).ease(o).attr("fill",n).attr("r",(t=>this._valueScale(t.data[a]))).attr("transform",(t=>`translate(${t.x}, ${t.y})`)).selection().style("cursor","pointer").classed("subtree-hidden",(t=>!!t.data[`_${i}`])).classed("leaf-node",(t=>!t.data[i])),T.call(this,"_nodeGroupElements",s||((t,i)=>`${i.ancestors().map((t=>t.data[e])).reverse().join("-><br/>")} : <strong>${d3.format(",d")(i.data[a])} </strong>`))}renderText(){const{verticalTree:{nodeKey:t,valueKey:e,uniqueKey:i,animation:{duration:a,ease:r}},tooltip:{format:o}}=this._option;this._textGroupElements=this._textGroup.selectAll("text").data(this._rootData.descendants(),(t=>t.data[i])).join((t=>t.append("text").attr("transform",(t=>`translate(${t.x}, ${t.y}) rotate(90)`))),(t=>t),(t=>t.remove())).transition().duration(a).ease(r).attr("font-size",(t=>this._valueScale(t.data[e]))).attr("dy","0.31em").attr("dx","10").attr("transform",(t=>`translate(${t.x}, ${t.y}) rotate(90)`)).attr("dx",(t=>t.children?"-1em":"1em")).attr("text-anchor",(t=>t.children?"end":"start")).selection().html((e=>e.data[t])).style("cursor","pointer"),T.call(this,"_textGroupElements",o||((i,a)=>`${a.ancestors().map((e=>e.data[t])).reverse().join("-><br/>")} : <strong>${d3.format(",d")(a.data[e])} </strong>`))}}a.registerStrategy("horizontalTree",O).registerStrategy("verticalTree",W);class M{constructor(t,e,i){this._domId=t,this._option=e,this._theme=i||j,$.call(this,t,e)}render(){E.call(this),u.call(this,"_linkGroup","link-group","main"),u.call(this,"_nodeGroup","node-group","main"),u.call(this,"_textGroup","text-group","main"),this.renderData(),this.renderScale(),this.renderForce(),this.renderNode(),this.renderLink(),this.renderText(),this.renderTick()}renderData(){const{nodes:{key:t},links:{key:e}}=this._option;this._nodes=this._data[t],this._links=this._data[e]}renderScale(){const{nodes:{nodeSizeExtent:t,nodeOpacityExtent:e,sizeKey:i,groupKey:a},links:{lineWidthExtent:r,lineOpacityExtent:o,valueKey:s}}=this._option,{colorSets:n}=this._theme;this._nodeSizeScale=d3.scaleLinear().domain(d3.extent(this._nodes,(t=>t[i]))).range(t),this._nodeOpacityScale=d3.scaleLinear().domain(d3.extent(this._nodes,(t=>t[i]))).range(e),this._linkWidthScale=d3.scaleLinear().domain(d3.extent(this._links,(t=>t[s]))).range(r),this._linkOpacityScale=d3.scaleLinear().domain(d3.extent(this._links,(t=>t[s]))).range(o),this._nodeGroupScale=d3.scaleOrdinal().domain(Array.from(new Set(this._nodes.map((t=>t[a]))))).range(n)}renderForce(){const{nodes:{nameKey:t},forceSimulation:{forceCollide:{radius:e,strength:i},forceLink:{distance:a},forceManyBody:{strength:r,theta:o,distanceMin:s},forceX:{strength:n,x:l},forceY:{strength:h,y:c}}}=this._option;this._forceSimulation=d3.forceSimulation(this._nodes).force("forceLink",d3.forceLink(this._links).id((e=>e[t])).distance(a)).force("forceManyBody",d3.forceManyBody().strength(r).theta(o).distanceMin(s)).force("forceCenter",d3.forceCenter(this._innerWidth/2,this._innerHeight/2)).force("forceCollide",d3.forceCollide().radius(e).strength(i)).force("forceX",d3.forceX().x(l).strength(n)).force("forceY",d3.forceY().y(c).strength(h))}renderNode(){const{nodes:{sizeKey:t,groupKey:e,on:{click:i,mouseover:a,mouseout:r}},tooltip:{format:o}}=this._option;this._nodeGroupElements=this._nodeGroup.selectAll("circle").data(this._nodes).join("circle").attr("fill",(t=>this._nodeGroupScale(t[e]))).attr("fill-opacity",(e=>this._nodeOpacityScale(e[t]))).attr("r",(e=>this._nodeSizeScale(e[t]))).call(this.drag()).on("click",((t,e)=>i(t,e,this._data))),T.call(this,"_nodeGroupElements",o)}renderLink(){const{links:{sourceKey:t,targetKey:e,valueKey:i}}=this._option,{primary4:a}=this._theme;this._linkGroupElements=this._linkGroup.selectAll("line").data(this._links).join("line").attr("stroke-opacity",(t=>this._linkOpacityScale(t[i]))).attr("stroke",a).attr("d",(i=>"M "+i[t].x+" "+i[t].y+" L "+i[e].x+" "+i[e].y)).attr("stroke-width",(t=>this._linkWidthScale(t[i])))}renderText(){const{nodes:{nameKey:t,sizeKey:e,groupKey:i,on:{click:a,mouseover:r,mouseout:o}},tooltip:{format:s}}=this._option;this._textGroupElements=this._textGroup.selectAll("text").data(this._nodes).join("text").text((e=>e[t])).attr("fill",(t=>this._nodeGroupScale(t[i]))).attr("fill-opacity",(t=>this._nodeOpacityScale(t[e]))).style("font-size",(t=>this._nodeSizeScale(t[e]))).call(this.drag()).on("click",((t,e)=>a(t,e,this._data))),T.call(this,"_textGroupElements",s)}renderTick(){const{links:{sourceKey:t,targetKey:e},nodes:{nodeSizeExtent:i}}=this._option,a=(i[0]+i[1])/2;this._forceSimulation.on("tick",(()=>{this._textGroupElements.attr("transform",(function(t){return`translate(${t.x+a},${t.y})`})),this._nodeGroupElements.attr("transform",(function(t){return`translate(${t.x},${t.y})`})),this._linkGroupElements.attr("x1",(e=>e[t].x)).attr("y1",(e=>e[t].y)).attr("x2",(t=>t[e].x)).attr("y2",(t=>t[e].y))}))}drag(){return d3.drag().on("start",((t,e)=>{t.active||this._forceSimulation.alphaTarget(.3).restart(),t.subject.fx=t.subject.x,t.subject.fy=t.subject.y})).on("drag",((t,e)=>{t.subject.fx=t.x,t.subject.fy=t.y})).on("end",((t,e)=>{t.active||this._forceSimulation.alphaTarget(0),t.subject.fx=null,t.subject.fy=null}))}}a.registerStrategy("forceDirected",M),t.AlgorithmBar=C,t.AlgorithmTree=A,t.ForceDirected=M,t.HorizontalBar=I,t.HorizontalTree=O,t.Pie=H,t.VerticalBar=D,t.VerticalTree=W,t.init=(t,e,i)=>a.useStrategy(t,e,i),t.register=(t,e)=>{a.registerStrategy(t,e)},Object.defineProperty(t,"__esModule",{value:!0})}));
